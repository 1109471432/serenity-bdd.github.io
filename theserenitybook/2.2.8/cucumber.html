<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Serenity with Cucumber :: The Serenity BDD Book</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="shortcut icon" type="image/x-icon" href="../../_/img/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="../../_/img/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../_/img/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../_/img/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../_/img/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../_/img/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../_/img/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../../_/img/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../../_/img/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../_/img/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../../_/img/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../_/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../../_/img/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../_/img/favicon-16x16.png">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="../../_/img/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">The Serenity BDD Book</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core">Source Code on Github</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/training/">Learn BDD</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Video Tutorials</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Online Training</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/serenity-bdd-mentoring/">Support</a>

        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div> -->
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="theserenitybook" data-version="2.2.8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">The Serenity Book</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity BDD Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Serenity BDD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="first-steps.html">First Steps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="step-libraries.html">Working with Step Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Testing Web Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="web-testing-in-serenity.html">Testing Web Applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="page-objects.html">Working with Page Objects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="angularjs.html">Testing AngularJS applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="remote.html">Running Remote Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extending-webdriver.html">Extending Webdriver</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="environment-specific-config.html">Environment-specific configurations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-webdriver.html">Advanced WebDriver integration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity with JUnit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-basic.html">Basic JUnit Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit.html">JUnit WebDriver Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-skipping.html">Skipping Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-data-driven.html">Data Driven Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-requirements.html">Modelling JUnit Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity with Cucumber</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="cucumber.html">Getting Started with Cucumber and Serenity</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cucumber-before-and-after.html">Setting up and tearing down test data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity with JBehave</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jbehave.html">Working with JBehave</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Working with REST APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-rest.html">REST API Testing in Serenity</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity and the Screenplay Pattern</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay.html">Screenplay Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="screenplay-selenium-tasks.html">Web Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-rest.html">REST API Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-ensure.html">Fluent Assertions in Screenplay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrating in Spring</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spring.html">Integration testing Spring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reporting and Living documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="living-documentation.html">Living Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="filtering-reports.html">Filtering Execution and Reports with Tags</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extended-reports.html">Additional Reports</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="manual-tests.html">Reporting Manual Test Results</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-issues.html">Integration with Issue &amp; Project Tracking systems</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jira.html">Integrating with JIRA</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="screenshot.html">Managing Screenshots</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="importing-test-outcomes.html">Importing test results generated by Serenity BDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Scaling Serenity</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel.html">Running Serenity tests in parallel on a local machine</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-grid.html">Running Serenity tests on a Selenium Grid</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel-batches.html">Running Serenity tests in parallel batches</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-system-properties.html">Serenity System Properties and Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Serenity Book</span>
    <span class="version">2.2.8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Serenity Book</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.2.8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">The Serenity Book</a></li>
    <li>Serenity with Cucumber</li>
    <li><a href="cucumber.html">Getting Started with Cucumber and Serenity</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/serenity-bdd/the-serenity-book/edit/master/modules/ROOT/pages/cucumber.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Serenity with Cucumber</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://cucumber.io">Cucumber</a> is a popular tool for automating BDD-style acceptance criteria.
Teams that practice BDD have conversations about business rules and examples to better understand the problem they are solving.
Some of these examples can be transformed into automated acceptance criteria.</p>
</div>
<div class="paragraph">
<p>Teams that use Cucumber express these acceptance criteria in a natural, human-readable form using the <code>given..when..then</code> structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Scenario: Cash withdrawal
  Given Clive has $1000 in his Current account
  When he withdraws $100 in cash
  Then his remaining balance should be $900</code></pre>
</div>
</div>
<div class="paragraph">
<p>This format is known as 'Gherkin', and is widely used in Cucumber and other Cucumber-based BDD tools such as SpecFlow (for .NET) and Behave (for Python).
Gherkin is a flexible, highly readable format that can be written collaboratively with product owners to ensure that everyone is on the same page.
The loosely-structured 'Given-When-Then' format helps people focus on what they are trying to achieve, and how they will know when they get it.</p>
</div>
<div class="paragraph">
<p>Gherkin also supports tabular data formats, which is a useful and concise way of representing many domain concepts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Scenario: Transferring funds between internal accounts
  Given Clive has the following accounts:
    | Account | Balance |
    | Current | 1000    |
    | Savings | 2000    |
  When he transfers $100 from his Current account to his Savings account
  Then his new account balances should be:
    | Account | Balance |
    | Current | 900     |
    | Savings | 2100    |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes tables can be used to summarise several different examples of the same scenario.
For example, the following scenario illustrates the fee structure for different account types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Scenario Outline: Account Fees for different types of account
  Given Clive has an &lt;Account Type&gt; account with a balance of &lt;Sample Balance&gt;
  When the monthly fees are calculated
  Then a &lt;Monthly Fee&gt; monthly fee of &lt;Sample Fee&gt; should be deducted
  Examples:
  | Account Type | Monthly Fee | Sample Balance | Sample Fee |
  | Current      | $1.50       | 1000           | 1.50       |
  | Savings      | $0.00       | 1000           | 0.00       |
  | Investment   | 0.25%       | 1000           | 2.50       |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity BDD integrates very smoothly with Cucumber.
When you implement your Cucumber scenarios with Serenity BDD, you benefit from the powerful Serenity reporting features, which are fine-tuned to work well with Cucumber. But Serenity also makes it easier to write cleaner, more maintainable test automation code.</p>
</div>
<div id="fig-cucumber-feature" class="imageblock">
<div class="content">
<img src="_images/cucumber-cash-withdrawals-feature.png" alt="cucumber cash withdrawals feature" width="475">
</div>
<div class="title">Figure 1. A Cucumber scenario in a Serenity report</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_cucumber_with_serenity_bdd"><a class="anchor" href="#_using_cucumber_with_serenity_bdd"></a>Using Cucumber with Serenity BDD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are currently two commonly-used versions of Cucumber: Cucumber 2 and Cucumber 4.
While they both support the same <em>Gherkin</em> notation, the way you implement the steps is a little different in each version.
When you use Serenity with Cucumber, you use a different dependency depending on the version of Cucumber you want to use.</p>
</div>
<div class="paragraph">
<p>New versions come out regularly: you can find out what the latest stable versions are <a href="https://github.com/serenity-bdd/serenity-core/#what-is-the-latest-stable-version-i-should-use">on the Serenity BDD Github home page</a>.</p>
</div>
<div class="sect2">
<h3 id="_working_with_cucumber_2"><a class="anchor" href="#_working_with_cucumber_2"></a>Working with Cucumber 2</h3>
<div class="paragraph">
<p>To get started with Cucumber 2 and Serenity, you will need to add the Serenity Cucumber plugin to your project.
In Maven, just add the following dependencies to your pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-core&lt;/artifactId&gt;
            &lt;version&gt;${serenity.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-junit&lt;/artifactId&gt;
            &lt;version&gt;${serenity.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-cucumber&lt;/artifactId&gt;
            &lt;version&gt;${serenity.cucumber.version}&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent in Gradle is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    testCompile 'net.serenity-bdd:core:2.0.64'
    testCompile 'net.serenity-bdd:serenity-junit:2.0.64'
    testCompile 'net.serenity-bdd:serenity-cucumber:2.0.19'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_cucumber_4"><a class="anchor" href="#_working_with_cucumber_4"></a>Working with Cucumber 4</h3>
<div class="paragraph">
<p>The Cucumber 4 dependency setup is a bit more complicated, as you need to override the Cucumber 2 dependency in Serenity core.
In Maven, you need add the following dependency configuration to your pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-core&lt;/artifactId&gt;
            &lt;version&gt;${serenity.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
                    &lt;artifactId&gt;cucumber-core&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-screenplay&lt;/artifactId&gt;
            &lt;version&gt;${serenity.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
                    &lt;artifactId&gt;cucumber-core&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-cucumber4&lt;/artifactId&gt;
            &lt;version&gt;${serenity.cucumber4.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-java&lt;/artifactId&gt;
            &lt;version&gt;4.2.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-junit&lt;/artifactId&gt;
            &lt;version&gt;4.2.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent in Gradle is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">configurations.all {
    resolutionStrategy {
        force "io.cucumber:cucumber-core:4.2.0"
    }
}

dependencies {
    testCompile "net.serenity-bdd:serenity-core:2.0.64",
            "net.serenity-bdd:serenity-cucumber4:1.0.19",
            "io.cucumber:cucumber-core:4.2.0",
            "io.cucumber:cucumber-junit:4.2.0"

    // Other dependencies
    testCompile "org.slf4j:slf4j-api:1.7.5",
            "junit:junit:4.12",
            "org.assertj:assertj-core:1.7.0"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_cucumber_maven_archetype"><a class="anchor" href="#_using_the_cucumber_maven_archetype"></a>Using the Cucumber Maven Archetype</h3>
<div class="paragraph">
<p>If you are starting from scratch, a Cucumber archetype for Cucumber 2 is available to help you jumpstart a new project.
As usual, you can run <code>mvn archetype:generate -Dfilter=serenity</code> from the command line
and then select the <code>net.serenity-bdd:serenity-cucumber-archetype</code> archetype from the proposed list of archetypes.
Or you can use your favourite IDE to generate a new Maven project using an archetype.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_executable_specifications_with_cucumber_and_serenity"><a class="anchor" href="#_writing_executable_specifications_with_cucumber_and_serenity"></a>Writing Executable Specifications with Cucumber and Serenity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Cucumber, scenarios are stored in <em>Feature Files</em>, which contain an overall description of a feature as well as a number of scenarios.
The Feature File for the first example we saw earlier is called <code>cash_withdrawals.feature</code>, and looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature: Cash Withdrawals

  Scenario: Cash withdrawal
    Given Clive has $1000 in his Current account
    When he withdraws $100 in cash
    Then his remaining balance should be $900</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_organising_your_feature_files"><a class="anchor" href="#_organising_your_feature_files"></a>Organising your feature files</h3>
<div class="paragraph">
<p>The simplest way to organise your Serenity/Cucumber feature files is to place them in the <code>src/test/resources/features</code> directory.</p>
</div>
<div class="paragraph">
<p>But placing all your feature files in one directory can become messy as your project grows.
To make the feature files easier to manage, in Serenity projects we typically organise the feature files in sub-directories that reflect the higher-level requirements.
You can think of each subdirectory as a chapter or section heading in your living documentation, with the features grouped inside these sections.
For example, in the following directory structure, we have feature definitions for several capabilities related to an online store, including 'search_for_products', 'make_a_purchase' and 'request_a_refund':</p>
</div>
<div class="listingblock">
<div class="content">
<pre>|____src
| |____test
| | |____resources
| | | |____features
| | | | |____banking_app
| | | | | |____deposits_and_withdrawals
| | | | | | |____internal_transfers.feature
| | | | | | |____inter_bank_transfers.feature
| | | | | | |____cash_withdrawals.feature
| | | | | |____opening_an_account
| | | | | | |____opening_current_savings.feature
| | | | | | |____opening_business_accounts.feature
| | | | | | |____opening_current_accounts.feature
| | | | | |____closing_an_account
| | | | | | |____closing_a_business_account.feature
| | | | | | |____closing_an_individual_account.feature</pre>
</div>
</div>
<div class="paragraph">
<p>This requirements structure is reflected in the <em>Requirements</em> tab of the Serenity reports:</p>
</div>
<div id="fig-cucumber-requirements-hierarchy" class="imageblock">
<div class="content">
<img src="_images/cucumber-requirements-hierarchy.png" alt="cucumber requirements hierarchy" width="600">
</div>
<div class="title">Figure 2. A Cucumber requirements hierarchy report</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_scenario_runner"><a class="anchor" href="#_the_scenario_runner"></a>The Scenario Runner</h3>
<div class="paragraph">
<p>Cucumber runs the feature files via JUnit, and needs a dedicated test runner class to actually run the feature files.
When you run the tests with Serenity, you use the <code>CucumberWithSerenity</code> test runner.
You also need to use the <code>@CucumberOptions</code> class to provide the root directory where the feature files can be found.</p>
</div>
<div class="paragraph">
<p>A simple test runner looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RunWith(CucumberWithSerenity.class)                    <i class="conum" data-value="1"></i><b>(1)</b>
@CucumberOptions(
        features="src/test/resources/features",         <i class="conum" data-value="2"></i><b>(2)</b>
        glue = "net.serenity_bdd.samples")              <i class="conum" data-value="3"></i><b>(3)</b>
public class CashWithdrawals {
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Serenity Cucumber feature files need the <code>CucumberWithSerenity</code> test runner.</p>
</li>
<li>
<p>The <code>features</code> attribute indicates where to look for the feature files, and can be a path to a directory or to a specific feature file</p>
</li>
<li>
<p>The <code>glue</code> attribute tells Cucumber where to find the Step Definition classes</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_cucumber_step_definitions"><a class="anchor" href="#_cucumber_step_definitions"></a>Cucumber Step definitions</h3>
<div class="paragraph">
<p>In Cucumber, each line of the Gherkin scenario maps to a method in a Java class, known as a 'Step Definition'.
These use annotations like <code>@Given</code>, <code>@When</code> and <code>@Then</code> match lines in the scenario to Java methods.
In this section, we will briefly look at how to write your own Cucumber step definitions in both Cucumber 2 and Cucumber 4.</p>
</div>
</div>
<div class="sect2">
<h3 id="_writing_step_definitions_in_cucumber_2"><a class="anchor" href="#_writing_step_definitions_in_cucumber_2"></a>Writing Step Definitions in Cucumber 2</h3>
<div class="paragraph">
<p>In Cucumber 2, you define simple regular expressions to indicate parameters that will be passed into the methods. The regular expressions indicate where you want to pass in a parameter. For example, in the following method, we use three regular expressions to match the name of the customer, the current account balance, and the account type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("^(.*) has \\$(\\d+) in his (.*) account$")
public void in_his_current_account(String customer, int balance, String accountType) {
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_simple_type_conversions"><a class="anchor" href="#_simple_type_conversions"></a>Simple type conversions</h4>
<div class="paragraph">
<p>As you can see in the previous code, Cucumber will convert the expressions you pass automatically into basic types such as <code>String</code>, <code>int</code> and <code>float</code>. You can also convert to enums, which can make your tests a bit more reliable. For example, we could create an <code>enum</code> to represent the different account types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public enum AccountType {
    Current, Savings, Investment
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could then use this enum as a parameter for the step definition method: Cucumber will do the conversion automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("^(.*) has \\$(\\d+) in his (.*) account$")
public void in_his_current_account(String customer, int balance, AccountType accountType) {
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_lists_and_tables"><a class="anchor" href="#_working_with_lists_and_tables"></a>Working with lists and tables</h4>
<div class="paragraph">
<p>Lists and tables are often used to make scenarios more concise and readable.
In the following step, we pass in a list of bank accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Given Clive has the following accounts:
  | Account | Balance |
  | Current | 1000    |
  | Savings | 2000    |</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few ways we can pass this table into our step definition.
One is to use the Cucumber <code>DataTable</code> class, which provides a number of helper methods to extract values from the table, or to convert the rows into a more usable form.</p>
</div>
<div class="paragraph">
<p>For example, suppose you had the following simple Java class to represent the account entries in the tables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class AccountDetails {
    private final AccountType account;
    private final int balance;

    public AccountDetails(AccountType account, int balance) {
        this.account = account;
        this.balance = balance;
    }

    public AccountType getAccount() {
        return account;
    }

    public int getBalance() {
        return balance;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could pass the table into your step definition method as a <code>DataTable</code>, and then use the <code>asList()</code> method to convert the entries to a list of <code>AccountDetails</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("^Clive has the following accounts:$")
public void cliveHasTheFollowingAccounts(DataTable accounts) {
    List&lt;AccountDetails&gt; accountDetails = accounts.asList(AccountDetails.class);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber also allows you to bypass the <code>DataTable</code> class and pass in a list of domain objects. So the step definition method shown above could be simplified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("^Clive has the following accounts:$")
public void cliveHasTheFollowingAccounts(List&lt;AccountDetails&gt; accountDetails) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another approach is to pass in a list of maps; each map represents one of the rows in the table, with the column headers as the keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("^Clive has the following accounts:$")
public void cliveHasTheFollowingAccounts(List&lt;Map&lt;String,String&gt;&gt; accountDetails) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach can be useful when you use a table to override default values. For example, an Account object might have many more fields than simply the account and balance fields, but in our example above we could safely use sensible default values for all the other fields, only overriding the values we are really interested in.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_step_definitions_in_cucumber_4"><a class="anchor" href="#_writing_step_definitions_in_cucumber_4"></a>Writing Step Definitions in Cucumber 4</h3>
<div class="paragraph">
<p>In Cucumber 4, you can use regular expressions, but also the more readable <a href="https://cucumber.io/docs/cucumber/cucumber-expressions">Cucumber Expressions</a> notation.</p>
</div>
<div class="paragraph">
<p><em>Cucumber Expressions</em> use tokens surrounded by curly brackets such as "{string}","{word}","{int}" and "{float}" to represent common types. <em>{string}</em> represents a sequence of characters enclosed in quotes (such as <code>"red car"</code>), whereas <em>{word}</em> matches a word containing no whitespaces and not enclosed in quotes (<code>red</code>, but not <code>"red"</code> or <code>red green</code>).  The <em>anonymous</em> parameter type ("{}") can be used to match any sequence of characters, like the "(.*)" wildcard regular expression.</p>
</div>
<div class="paragraph">
<p>The following step definition shows how we could use Cucumber Expressions for the "Given Clive has $1000 in his Current account" step  we saw earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("{word} has ${int} in his {word} account")
public void in_his_current_account(String customer, int balance, String accountType) {
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_simple_type_conversions_2"><a class="anchor" href="#_simple_type_conversions_2"></a>Simple type conversions</h4>
<div class="paragraph">
<p>Cucumber 4 does not automatically convert parameters to enums and domain classes the way Cucumber  2 does - a little more configuration is required. If you want to pass in an <code>AccountType</code> enum value directly, you need to define a custom parameter type.</p>
</div>
<div class="paragraph">
<p>Each custom parameter type has a name you can define, which makes the step definitions much more readable. For instance, we could define a custom parameter type called <code>AccountType</code>, and include it in the step definition annotation like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("{word} has ${int} in his {AccountType} account")
public void in_his_current_account(String customer,
                                   int balance,
                                   AccountType accountType) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However for this to work, we need to declare the <code>AccountType</code> custom parameter in the Cucumber <em>type registry</em>. We do this by adding an implementation of the <code>TypeRegistryConfigurer</code> class to our step definitions and defining a custom parameter type for our enum, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TypeRegistryConfiguration implements TypeRegistryConfigurer {
    @Override
    public Locale locale() {
        return ENGLISH;
    }

    @Override
    public void configureTypeRegistry(TypeRegistry typeRegistry) {
        typeRegistry.defineParameterType(ParameterType.fromEnum(AccountType.class));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_converting_parameters_to_custom_classes"><a class="anchor" href="#_converting_parameters_to_custom_classes"></a>Converting parameters to custom classes</h4>
<div class="paragraph">
<p>We can also use the Cucumber type registry to convert parameters to domain objects.
This helps reduce boiler-plate code in our step definitions and makes the Cucumber Expressions more readable.</p>
</div>
<div class="paragraph">
<p>One common use of this feature is in Screenplay tests, where we can define a custom <em>{actor}</em> parameter type. Normally, to convert the name of an actor to a Screenplay actor, we would use the <code>Actor.named()</code> method, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("{word} has ${int} in his {AccountType} account")
public void in_his_current_account(String customerName,
                                   int balance,
                                   AccountType accountType) {
    Actor customer = Actor.named(customerName);
    customer.attemptsTo(
        OpenABankAccount.ofType(accountType).withABalanceOf(balance)
    );
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Cucumber 4, we can define a custom parameter type so that we can pass a Screenplay actor directly into a step definition method, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("{actor} has ${int} in his {AccountType} account")
public void in_his_current_account(Actor customer,
                                   int balance,
                                   AccountType accountType) {
     customer.attemptsTo(
         OpenABankAccount.ofType(accountType).withABalanceOf(balance)
     );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To do this, we need to include the actor creation logic in the Cucumber Type Registry, by using the <code>defineParameterType()</code> method in the <code>TypeRegistryConfiguration</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TypeRegistryConfiguration implements TypeRegistryConfigurer {
    @Override
    public Locale locale() { return ENGLISH; }

    @Override
    public void configureTypeRegistry(TypeRegistry typeRegistry) {
      typeRegistry.defineParameterType(new ParameterType&lt;&gt;(
              "actor",                                        <i class="conum" data-value="1"></i><b>(1)</b>
              ".*",                                           <i class="conum" data-value="2"></i><b>(2)</b>
              Actor.class,                                    <i class="conum" data-value="3"></i><b>(3)</b>
              (String actorName) -&gt; Actor.named(actorName)))  <i class="conum" data-value="4"></i><b>(4)</b>
        );
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The name of the custom parameter</p>
</li>
<li>
<p>The regular expression used to capture the parameter value</p>
</li>
<li>
<p>The parameter type</p>
</li>
<li>
<p>A lambda expression to convert the String parameter to the target type</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_data_tables"><a class="anchor" href="#_working_with_data_tables"></a>Working with data tables</h4>
<div class="paragraph">
<p>In Cucumber 2, it is relatively easy to pass a data table to a step definition method as a list of domain objects. We saw this earlier with the following step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Given Clive has the following accounts:
  | Account | Balance |
  | Current | 1000    |
  | Savings | 2000    |</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Cucumber 4, as in Cucumber 2, we can pass in a <code>DataTable</code> or a list of maps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("^Clive has the following accounts:$")
public void hasTheFollowingAccounts(List&lt;Map&lt;String,String&gt;&gt; accounts) {
    ....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However if we want to pass in a list of domain objects, or convert a <code>DataTable</code> to a domain object or a list of domain objects, we need to do a little more work.</p>
</div>
<div class="sect4">
<h5 id="_converting_data_table_rows_to_objects"><a class="anchor" href="#_converting_data_table_rows_to_objects"></a>Converting Data Table rows to objects</h5>
<div class="paragraph">
<p>Probably the simplest approach is to configure Cucumber to convert data table entries into Java objects using an <em>ObjectMapper</em>. Cucumber comes bundled with the Jackson <code>ObjectMapper</code>, which converts Cucumber table entries to JSON, and then into Java. This is relatively easy to set up, but it does need a few minor tweaks to your Gherkin and Java code.</p>
</div>
<div class="paragraph">
<p>First of all, Jackson needs a default constructor in the classes it creates. So we need to refactor the <code>AccountDetails</code> class to look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AccountDetails {
    private AccountType account;
    private int balance;

    public AccountDetails(AccountType account, int balance) {
        this.account = account;
        this.balance = balance;
    }

    public AccountDetails() {} <i class="conum" data-value="1"></i><b>(1)</b>

    public AccountType getAccount() {
        return account;
    }

    public int getBalance() {
        return balance;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Jackson needs a default constructor to work correctly</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Secondly, the column names need to match the Java field names exactly.
One option is to write the column headings in lower case, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Given Clive has the following accounts:
  | account | balance |
  | Current | 1000    |
  | Savings | 2000    |</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other option is to use the <code>@JsonProperty</code> annotation to change the default field names used by Jackson:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AccountDetails {
    private AccountType account;
    private int balance;

    public AccountDetails(AccountType account, int balance) {
        this.account = account;
        this.balance = balance;
    }

    public AccountDetails() {}

    @JsonProperty("Account")
    public AccountType getAccount() {
        return account;
    }

    @JsonProperty("Balance")
    public int getBalance() {
        return balance;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last thing we need to do is to register the ObjectMapper with the Cucumber type registry.
This involves writing a <em>Transformer</em> class that implements the <code>TableEntryByTypeTransformer</code> interface. One that uses the bundled Jackson <code>ObjectMapper</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class Transformer implements TableEntryByTypeTransformer {

    ObjectMapper objectMapper = new ObjectMapper();

    @Override
    public &lt;T&gt; T transform(Map&lt;String, String&gt; map,
                          Class&lt;T&gt; aClass,
                          TableCellByTypeTransformer typeTransformer) {
        return objectMapper.convertValue(map, aClass);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we need to register the transformer by adding the following code to the <code>configureTypeRegistry()</code> method we saw earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Transformer transformer = new Transformer();
typeRegistry.setDefaultDataTableEntryTransformer(transformer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now pass the list of account details into the step definition method as a list of <code>AccountDetail</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("Clive has the following accounts:")
public void cliveHasTheFollowingAccounts(List&lt;AccountDetails&gt; accounts) {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_serenity_step_libraries_in_cucumber_step_definitions"><a class="anchor" href="#_using_serenity_step_libraries_in_cucumber_step_definitions"></a>Using Serenity step libraries in Cucumber Step definitions</h3>
<div class="paragraph">
<p>It is perfectly possible to call classic test automation code directly in your step definition methods. In this case, Serenity will only report on the <em>Given..When..Then</em> steps, and leave you full control of the underlying code.</p>
</div>
<div class="paragraph">
<p>Many teams however find it useful to organise their tests into reusable components and domain layer classes. And Serenity provides many ways to help with this.</p>
</div>
<div class="paragraph">
<p>Serenity Step Libraries integrate smoothly into Cucumber Step Definition files;
all you need to do is to annotate a step library variable with the <code>@Steps</code> annotation. For example, suppose our banking application has a set of web services to handle account balances and withdrawals. We could wrap these web service calls in Serenity Action classes, and inject these action classes into the step definition classes using the Serenity <code>@Steps</code> annotation, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CashWithdrawalsStepDefinitions {
    @Steps
    CreateAccountAction createAnAccount;

    @Given("{word} has ${int} in his {word} account")
    public void in_his_current_account(String customer,
                                       int balance,
                                       String accountType) {
        createAnAccount.forCustomer(customer)
                       .ofType(accountType)
                       .withABalanceOf(balance);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Action class uses a builder pattern for better readability.
We use the <code>@Step</code> annotation on the last method to ensure that we get a complete description of the step in our reports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CreateAccountAction {
    String customerName;
    String accountType;

    public CreateAccountAction forCustomer(String customerName) {
        this.customerName = customerName;
        return this;
    }

    public CreateAccountAction ofType(String accountType) {
        this.accountType = accountType;
        return this;
    }

    @Step("Create a #accountType account for customer #customerName with a balance of ${0}")
    public int withABalanceOf(int balance) {
        // Call the appropriate web service and return the account unique ID
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other step definition methods would use similar step libraries.
Some teams group their step libraries by theme or end point (for example, they might place all the web service calls related to managing a bank account in a single <code>BankAccountActions</code> step library). Others prefer to enforce a stricter separation of concerns, and have a single class per action (this approach is know as the <em>Action Classes</em> pattern), as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CashWithdrawalsStepDefinitions {

    @Steps
    CreateAccountAction createAnAccount;

    @Steps
    WithdrawAction withdraw;

    @Steps
    AccountBalanceAction accountBalance;

    int accountIdentifier;

    @Given("{word} has ${int} in his {word} account")
    public void in_his_current_account(String customer, int balance, String accountType) {
        accountIdentifier = createAnAccount.forCustomer(customer).ofType(accountType).withABalanceOf(balance);
    }

    @When("he withdraws ${int} in cash")
    public void he_withdraws_in_cash(int withdrawal) {
        withdraw.fromAccount(accountIdentifier).theSumOf(withdrawal);
    }

    @Then("his remaining balance should be ${int}")
    public void his_remaining_balance_should_be(int expectedBalance) {
        assertThat(accountBalance.forAccount(accountIdentifier)).isEqualTo(expectedBalance);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_with_serenity_page_objects"><a class="anchor" href="#_integrating_with_serenity_page_objects"></a>Integrating with Serenity Page Objects</h3>
<div class="paragraph">
<p>Integration Cucumber with Serenity UI tests is also easy. Unlike with JUnit, you don&#8217;t need to declare an <code>@Managed</code> WebDriver instance in your tests; Serenity will automatically instantiate a driver on demand.</p>
</div>
<div class="paragraph">
<p>For example, the following scenario is a very simple example of using a search engine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature: Search by keyword

  Scenario: Search for terms by a single keyword
    Given Serge is on the Search page
    When he searches by "Tomato"
    Then he should only see search results containing the word "Tomato"</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could use Serenity Page Objects or UI Action Classes to model the UI interactions.
For example, the following Serenity <code>PageObject</code> models the DuckDuckGo home page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DefaultUrl("https://duckduckgo.com")
public class SearchPage extends PageObject {

    public void searchBy(String keyword) {
        $("#search_form_input_homepage").sendKeys(keyword, Keys.ENTER);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this one allows us to query the search results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ResultsPage extends PageObject {

    public List&lt;String&gt; getSearchResultTitles() {
        return findAll(".results .result__title")
                .stream()
                .map(WebElementFacade::getTextContent)
                .collect(Collectors.toList());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could use both of these page objects directly in our Cucumber step definition code, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SearchStepDefinitions {

    SearchPage searchPage;
    ResultsPage resultsPage;

    @Given("Serge is on the Search page")
    public void serge_is_on_the_Search_page() {
        searchPage.open();
    }

    @When("he searches by {string}")
    public void he_searches_by(String keyword) {
        searchPage.searchBy(keyword);
    }

    @Then("he should only see search results containing the word {string}")
    public void he_should_only_see_search_results_containing_the_word(String expectedKeyword) {
        resultsPage.getSearchResultTitles().forEach(
                title -&gt; assertThat(title).containsIgnoringCase(expectedKeyword)
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, we could use Action Classes or Step Libraries to encapsulate the UI logic.
In both cases, Serenity will instantiate the WebDriver instance for us the first time a page object is invoked.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_cucumber_and_serenity"><a class="anchor" href="#_configuring_cucumber_and_serenity"></a>Configuring Cucumber and Serenity</h3>
<div class="paragraph">
<p>Serenity provides a number of configuration options when using Cucumber.</p>
</div>
<div class="sect3">
<h4 id="_maintaining_the_browser_open_for_the_entire_feature"><a class="anchor" href="#_maintaining_the_browser_open_for_the_entire_feature"></a>Maintaining the browser open for the entire feature</h4>
<div class="paragraph">
<p>Reopening a browser session for each scenario can slow down your tests.
If you want Serenity to keep the browser open for the duration of a feature, you can set the following property in your <code>serenity.properties</code> or <code>serenity.conf</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">serenity.restart.for.each = feature</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maintaining_state_between_scenarios"><a class="anchor" href="#_maintaining_state_between_scenarios"></a>Maintaining state between scenarios</h4>
<div class="paragraph">
<p>You may also wish to maintain state between scenarios.
By default, Serenity will use new step libraries and action classes for each scenario.
However, if you want to share data between the scenarios of a feature, you can use the following option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">serenity.maintain.session = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this value set, you can now use either the <code>@Shared</code> annotation, or the <code>@Steps(shared=true)</code>. For example, suppose that the <code>CreateAccountAction</code> needs to retrieve a security token before making any calls, but that it only needs to do this once.
We could tell Serenity to maintain the same <code>CreateAccountAction</code> step library for all the scenarios in a feature file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Shared
CreateAccountAction createAnAccount;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_cucumber_with_serenity_screenplay"><a class="anchor" href="#_integrating_cucumber_with_serenity_screenplay"></a>Integrating Cucumber with Serenity Screenplay</h3>
<div class="paragraph">
<p><a href="serenity-screenplay.html">The Screenplay Pattern</a> is a popular technique among experienced test automation practitioners that makes it easier to write cleaner, more maintainable test automation code at scale.</p>
</div>
<div class="sect3">
<h4 id="_defining_the_screenplay_cast"><a class="anchor" href="#_defining_the_screenplay_cast"></a>Defining the Screenplay cast</h4>
<div class="paragraph">
<p>When we use Screenplay with Cucumber, it is possible to define an actor programmatically as we do in JUnit tests. However it is more common to pass the name of the actor dynamically to the step definition methods. We do this using the <code>OnStage</code> class.</p>
</div>
<div class="paragraph">
<p>In Cucumber, Serenity needs a <em>cast</em> of actors to draw on in the various step definitions. Each actor is uniquely identified by their name. We set this up by calling the <code>setTheStage()</code> method in a <code>@Before</code>-annotated method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Before
public void prepareTests() {
    OnState.setTheStage(new OnlineCast());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>OnlineCast</code> is a cast of actors with the ability to browse the web. For more sophisticated actor setups, we can use the <code>Cast.whereEveryoneCan()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Before
public void prepareTests() {
    OnState.setTheStage(OnlineCast.whereEveryoneCan(CallAnApi.at(ADMIN_REST_URL)));
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_invoking_an_actor"><a class="anchor" href="#_invoking_an_actor"></a>Invoking an actor</h4>
<div class="paragraph">
<p>Once we have set up the cast, any step can refer to an actor by name.
We can do this using the <code>OnStage.theActorCalled()</code> method, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Given("{word} has ${int} in his {AccountType} account")
public void in_his_current_account(String customerName,
                                   int balance,
                                   AccountType accountType) {
    OnStage.theActorCalled(customerName).attemptsTo(
        OpenABankAccount.ofType(accountType).withABalanceOf(balance)
    );
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We often use a static import to simplify this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">static import net.serenitybdd.screenplay.actors.OnStage.theActorCalled;

@Given("{word} has ${int} in his {AccountType} account")
public void in_his_current_account(String customerName,
                                   int balance,
                                   AccountType accountType) {
    theActorCalled(customerName).attemptsTo(
        OpenABankAccount.ofType(accountType).withABalanceOf(balance)
    );
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we do not have the name of the actor available within a step definition, we can also use the <code>theActorInTheSpotlight()</code> method, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@When("s?he filters her list to show only (.*) tasks")
public void filters_tasks_by(TodoStatusFilter status) {
    OnStage.theActorInTheSpotlight().attemptsTo(FilterItems.toShow(status));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more short-hand way of writing this code is to use the <code>OnStage.withCurrentActor()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@When("s?he filters her list to show only (.*) tasks")
public void filters_tasks_by(TodoStatusFilter status) {
  withCurrentActor(
          FilterItems.toShow(status)
  );
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_actors_in_hook_methods"><a class="anchor" href="#_using_actors_in_hook_methods"></a>Using Actors in Hook methods</h4>
<div class="paragraph">
<p>If you need to perform UI actions in test setup (for example, to log on to an application), you may not know the name of the actor who will be first mentioned in the Gherkin steps. You can still use an actor in this case, but you need to use the <code>OnStage.aNewActor()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Before(order=1)
public void set_the_stage() {
    OnStage.setTheStage(new OnlineCast());
}

@Before(order=2)
public void openApplication() {
    OnStage.aNewActor().attemptsTo(
        OpenTheTodoMVCApplication.onTheHomePage()
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>aNewActor()</code> method will create a new, unnamed actor, who will be associated with the first actor referred to by name in the subsequent steps.</p>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
