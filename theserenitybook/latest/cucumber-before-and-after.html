<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setting up and tearing down test data :: The Serenity BDD Book</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="shortcut icon" type="image/x-icon" href="../../_/img/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="../../_/img/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../_/img/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../_/img/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../_/img/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../_/img/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../_/img/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../../_/img/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../../_/img/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../_/img/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../../_/img/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../_/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../../_/img/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../_/img/favicon-16x16.png">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="../../_/img/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">The Serenity BDD Book</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core">Source Code on Github</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/training/">Learn BDD</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Video Tutorials</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Online Training</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/serenity-bdd-mentoring/">Support</a>

        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div> -->
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="theserenitybook" data-version="2.1.4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">The Serenity Book</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity BDD Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Serenity BDD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="first-steps.html">First Steps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="step-libraries.html">Working with Step Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Testing Web Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="web-testing-in-serenity.html">Testing Web Applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="page-objects.html">Working with Page Objects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="angularjs.html">Testing AngularJS applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="remote.html">Running Remote Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extending-webdriver.html">Extending Webdriver setup and teardown</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="environment-specific-config.html">Environment-specific configurations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity with JUnit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-basic.html">Basic JUnit Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit.html">JUnit WebDriver Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-skipping.html">Skipping Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-data-driven.html">Data Driven Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-requirements.html">Modelling JUnit Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity with Cucumber</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cucumber.html">Getting Started with Cucumber and Serenity</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="cucumber-before-and-after.html">Setting up and tearing down test data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity with JBehave</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jbehave.html">Working with JBehave</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Working with REST APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-rest.html">REST API Testing in Serenity</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Serenity and the Screenplay Pattern</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay.html">Screenplay Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="screenplay-selenium-tasks.html">Web Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-rest.html">REST API Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-ensure.html">Fluent Assertions in Screenplay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrating in Spring</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spring.html">Integration testing Spring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reporting and Living documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="living-documentation.html">Living Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="filtering-reports.html">Filtering Execution and Reports with Tags</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extended-reports.html">Additional Reports</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="manual-tests.html">Reporting Manual Test Results</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-issues.html">Integration with Issue &amp; Project Tracking systems</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jira.html">Integrating with JIRA</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="screenshot.html">Managing Screenshots</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Scaling Serenity</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel.html">Running Serenity tests in parallel on a local machine</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-grid.html">Running Serenity tests on a Selenium Grid</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel-batches.html">Running Serenity tests in parallel batches</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-system-properties.html">Serenity System Properties and Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Serenity Book</span>
    <span class="version">2.1.4</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Serenity Book</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.1.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">The Serenity Book</a></li>
    <li>Serenity with Cucumber</li>
    <li><a href="cucumber-before-and-after.html">Setting up and tearing down test data</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/serenity-bdd/the-serenity-book/edit/master/modules/ROOT/pages/cucumber-before-and-after.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Setting up and tearing down test data</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When we write automated acceptance tests we often need to perform some initial tasks to prepare test data or set up the test environment. Likewise, when a test finishes, we often need to tidy up the database or put the environment into a clean state. With Serenity BDD and Cucumber, there are several ways to perform these setup and teardown tasks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_data_in_the_background_step"><a class="anchor" href="#_setting_up_data_in_the_background_step"></a>Setting up data in the Background step</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For example, suppose we are writing a Todo application, and we have a scenario like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Scenario Outline: Viewing the items by status
  Given that Jane has a todo list containing &lt;tasks&gt;
  And she has completed the task called 'Walk the dog'
  When she filters her list to show only &lt;filter&gt; tasks
  Then her todo list should contain &lt;expected&gt;
  Examples:
    | tasks                       | filter    | expected      |
    | Buy some milk, Walk the dog | Active    | Buy some milk |
    | Buy some milk, Walk the dog | Completed | Walk the dog  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>To perform this test, we might need Jane to have an account, and have already logged on to the application. We could use the <code>Background</code> step for this, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Background:
  Given Jane has a Super Todo List App account
  And Jane is on the application home page</code></pre>
</div>
</div>
<div class="paragraph">
<p>Background steps are implemented just like any other Cucumber step. Using the Action Classes pattern, the step definitions might look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Steps
AccountActions accountManager;

@Steps
LogonActions logon;

@Steps
NavigateActions navigate;

@Given("^(.*) has a Super Todo List App account$")
public void openAnAccount(String name) {
    accountManager.opensAnAccountFor(name);
}

@Given("^(.*) is on the application home page$")
public void navigateToHomePageAs(String user) {
    logon.as(user);
    navigate.toTheHomePage();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Background steps are run before each scenario, including each example, so sometimes the test code might need to check whether a particular setup action has already been completed. For example, the <code>opensAnAccountFor()</code> method might be able to check whether an account for Jane already exists, and if it does simply clear any relevant data  for this account. Naturally this kind of logic will depend on the nature of your application.</p>
</div>
<div class="paragraph">
<p>The steps in a background section also appear in the test reports, which can be useful if the steps are relevant to understanding the scenario from a business perspective, but less so if they are simply about setting up test date. If your setup steps are more technical, or less directly relevant to the scenarios being tested, the <code>@Before</code> hook might be a better choice.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_before_hook"><a class="anchor" href="#_using_the_before_hook"></a>Using the @Before hook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>@Before</code> hook marks a method that is run before each scenario.
Suppose we just need to open the application on the home page, and don&#8217;t need to set up a specific user account.
In this case, the initial step, "Given Jane is on the application home page", is not very interesting from a business perspective. We could place it inside a <code>@Before</code> method as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Steps
NavigateActions navigate;

@Before
public void openTheApplication() {
  navigate.toTheHomePage();
}

@Given("^that (?:.*) has a todo list containing (.*)$")
public void has_a_list_containing(List&lt;String&gt; tasks) throws Exception {
    tasks.forEach(
            task -&gt; todoUser.adds_a_task(task)
    );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ordering_before_hook_methods"><a class="anchor" href="#_ordering_before_hook_methods"></a>Ordering @Before hook methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes you need to run <code>@Before</code> methods in a specific order. For example, if you are using Screenplay, you need to set the stage with an online cast before you can do any web interactions. Cucumber allows you to define the execution order of hook methods with the <code>order</code> attribute. So your code might look more like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Before(order=1)
public void set_the_stage() {
    OnStage.setTheStage(new OnlineCast());
}

@Before(order=2)
public void openApplication() {
    OnStage.aNewActor().attemptsTo(
        OpenTheTodoMVCApplication.onTheHomePage()
    );
}

@Given("^that (.*) has a todo list containing (.*)$")
public void has_a_todo_list(String actorName, String itemList) {
    List&lt;String&gt; items = split(itemList);
    theActorCalled(actorName).wasAbleTo(
        AddTodoItems.called(items)
    );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_selectively_running_before_hook_methods"><a class="anchor" href="#_selectively_running_before_hook_methods"></a>Selectively running @Before hook methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also use tags to define which of the <code>@Before</code> hook methods you need to run for a given scenario.
For example, you might only need to create a cast of Selenium-enabled actors for web tests. One approach to this would be to add a special tag (say, <code>@web</code>) to the scenarios that use web interactions, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">@web
Scenario Outline: Viewing the items by status
  Given that Jane has a todo list containing &lt;tasks&gt;
  And she has completed the task called 'Walk the dog'
  When she filters her list to show only &lt;filter&gt; tasks
  Then her todo list should contain &lt;expected&gt;
  Examples:
    | tasks                       | filter    | expected      |
    | Buy some milk, Walk the dog | Active    | Buy some milk |
    | Buy some milk, Walk the dog | Completed | Walk the dog  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you can ensure that the UI-test hook methods web tests are only executed for UI-based scenarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Before(value="@web", order=1)
public void set_the_stage() {
    OnStage.setTheStage(new OnlineCast());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tidying_up_with_the_after_hook"><a class="anchor" href="#_tidying_up_with_the_after_hook"></a>Tidying up with the @After hook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cucumber <code>@After</code> hook is executed after each scenarios.</p>
</div>
<div class="paragraph">
<p>For example, the following code deletes all of the todo items created during a scenario. This allows us to keep the same browser open for the entire feature, which can improve test performance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@After
public void tidyUp() {
    theActorInTheSpotlight().attemptsTo(DeleteAll.items());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that for performance and reliability reasons, cleanup operations are generally best done via backend methods (e.g. via REST or JDBC calls) rather than through the UI.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
