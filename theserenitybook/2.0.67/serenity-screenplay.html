<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing User-centric tests using Serenity Screenplay :: The Serenity BDD Book</title>
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">The Serenity BDD Book</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core">Source Code on Github</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Online Tutorials</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Get Certified in Serenity BDD</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/serenity-bdd-mentoring/">Serenity Support</a>

        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div> -->
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="theserenitybook" data-version="2.0.67">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">The Serenity Book</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity BDD Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Serenity BDD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="first-steps.html">First Steps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="step-libraries.html">Working with Step Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing Web Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="web-testing-in-serenity.html">Testing Web Applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="page-objects.html">Working with Page Objects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="angularjs.html">Testing AngularJS applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="remote.html">Running Remote Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extending-webdriver.html">Extending Webdriver setup and teardown</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="environment-specific-config.html">Environment-specific configurations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity with JUnit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-basic.html">Basic JUnit Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit.html">JUnit WebDriver Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-skipping.html">Skipping Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-data-driven.html">Data Driven Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-requirements.html">Modelling JUnit Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity with Cucumber</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cucumber.html">Getting Started with Cucumber and Serenity</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cucumber-before-and-after.html">Setting up and tearing down test data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity with JBehave</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jbehave.html">Working with JBehave</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Working with REST APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-rest.html">REST API Testing in Serenity</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity and the Screenplay Pattern</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="serenity-screenplay.html">Screenplay Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="screenplay-selenium-tasks.html">Web Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-rest.html">REST API Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-ensure.html">Fluent Assertions in Screenplay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reporting and Living documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="living-documentation.html">Living Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="filtering-reports.html">Filtering Reports</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extended-reports.html">Additional Reports</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="manual-tests.html">Reporting Manual Test Results</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="jira.html">Integrating with JIRA</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Scaling Serenity</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel.html">Running Serenity tests in parallel on a local machine</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-grid.html">Running Serenity tests on a Selenium Grid</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel-batches.html">Running Serenity tests in parallel batches</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.adoc">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Serenity Book</span>
    <span class="version">2.0.67</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Serenity Book</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.0.67</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">The Serenity Book</a></li>
    <li class="crumb">Serenity and the Screenplay Pattern</li>
    <li class="crumb"><a href="serenity-screenplay.html">Screenplay Fundamentals</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/serenity-bdd/the-serenity-book/edit/master/modules/ROOT/pages/serenity-screenplay.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Writing User-centric tests using Serenity Screenplay</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Screenplay Pattern is an approach to writing high quality automated acceptance tests based on good software engineering principles such as the Single Responsibility Principle, the Open-Closed Principle, and effective use of Layers of Abstraction. It encourages good testing habits and well-designed test suites that are easy to read, easy to maintain and easy to extend, enabling teams to write more robust and more reliable automated tests more effectively.</p>
</div>
<div class="paragraph">
<p>In this section we will look at how to use the Screenplay Pattern with Serenity BDD. We will be illustrating the Screenplay Pattern using the AngularJS implementation of the well-known TodoMVC (<a href="http://todomvc.com" class="bare">http://todomvc.com</a>) project (see <a href="#fig-todomvc-app">The Screenplay Pattern will be illustrated by some tests against the TodoMVC application</a>). You can experiment with this application at <a href="http://todomvc.com/examples/angularjs/#/" class="bare">http://todomvc.com/examples/angularjs/#/</a>.</p>
</div>
<div id="fig-todomvc-app" class="imageblock">
<div class="content">
<img src="_images/journey-todo-app.png" alt="journey todo app">
</div>
<div class="title">Figure 1. The Screenplay Pattern will be illustrated by some tests against the TodoMVC application</div>
</div>
<div class="paragraph">
<p>You can use the Screenplay Pattern with Serenity BDD in JUnit, Cucumber or JBehave. For simplicity, the examples will be using JUnit.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introducing_the_screenplay_pattern"><a class="anchor" href="#_introducing_the_screenplay_pattern"></a>Introducing the Screenplay Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose we are implementing the “Add new todo items” feature of the ToDo MVC application. This feature could have an acceptance criteria along the lines of “Should be able to add a new todo item”. If we were testing these scenarios manually, we could create test plans like the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Should be able to add a new todo item</p>
<div class="ulist">
<ul>
<li>
<p>Open the application</p>
</li>
<li>
<p>Add an item called ‘Buy some milk’</p>
</li>
<li>
<p>The ‘Buy some milk’ item should appear in the todo list</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the Screenplay Pattern, we could write this code very naturally like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the motivations behind the Screenplay Pattern is the highly readable test code that it produces. Even if you are not familiar with how this code is implemented under the hood, it should be quite obvious what the test is trying to demonstrate, and how it is going about it.</p>
</div>
<div class="paragraph">
<p>In addition, the Serenity reports produced for this test also reflect this narrative structure, making it easier for testers, business analysts and business people to understand what the tests are actually demonstrating. A typical Screenplay Pattern report is shown in <a href="#fig-todomvc-report">The Serenity report documents both the intent and the implementation of the test</a>.</p>
</div>
<div id="fig-todomvc-report" class="imageblock">
<div class="content">
<img src="_images/journey-report.png" alt="journey report">
</div>
<div class="title">Figure 2. The Serenity report documents both the intent and the implementation of the test</div>
</div>
<div class="paragraph">
<p>The code listed above certainly reads cleanly, but it may leave you wondering how it actually works under the hood. Let’s see how it all fits together.</p>
</div>
<div class="sect2">
<h3 id="_screenplay_pattern_tests_runs_like_any_other_serenity_test"><a class="anchor" href="#_screenplay_pattern_tests_runs_like_any_other_serenity_test"></a>Screenplay Pattern tests runs like any other Serenity test</h3>
<div class="paragraph">
<p>The Serenity Screenplay Pattern currently integrates with both JUnit and Cucumber. In JUnit, you use the SerenityRunner JUnit runner, as for any other Serenity JUnit tests. The full source code of the test we saw earlier is shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s not hard to guess what this test does just by reading the code. There are however a few things here that are new. In the following sections, we will take a closer look at the details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_layers_of_abstraction"><a class="anchor" href="#_layers_of_abstraction"></a>Layers of abstraction</h3>
<div class="paragraph">
<p>Experienced automated testers use layers of abstraction to separate the intent of the test (what you are trying to achieve) from the implementation details (how you achieve it). By separating the what from the how, the intent from the implementation, layers of abstraction help make tests easier to understand and to maintain. Indeed, well defined layers of abstraction are perhaps the single most important factor in writing high quality automated tests.</p>
</div>
<div class="paragraph">
<p>In User Experience (UX) Design, we break down the way a user interacts with an application into goals, tasks and actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The goal describes what the user is trying to achieve in business terms</p>
</li>
<li>
<p>The tasks describe the high level steps the user needs to perform to achieve this goal, and</p>
</li>
<li>
<p>The actions correspond to how a user interacts with the system to perform a particular task, such as by clicking on a button or entering a value into a field.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Screenplay Pattern in Serenity BDD provides a clear distinction between tasks and actions, which makes it easier for teams to write layered tests more consistently.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_and_the_screenplay_pattern"><a class="anchor" href="#_actors_and_the_screenplay_pattern"></a>Actors and the Screenplay Pattern</h3>
<div class="paragraph">
<p>Tests describe how a user interacts with the application to achieve a goal. For this reason, tests read much better if they are presented from the point of view of the user.</p>
</div>
<div class="paragraph">
<p>In the Screenplay Pattern, we call a user interacting with the system an <em>Actor</em>. Actors are at the heart of the Screenplay Pattern (see <a href="#fig-journey-actors">The Screenplay Pattern uses an actor-centric model</a>). Each actor has a certain number of <em>Abilities</em>, such as the ability to browse the web or to query a restful web service. Actors can also perform <em>Tasks</em> such as adding an item to the Todo list. To achieve these tasks, they will typically need to interact with the application, such as by entering a value into a field or by clicking on a button. We call these interactions <em>Actions</em>. Actors can also ask <em>Questions</em> about the state of the application, such as by reading the value of a field on the screen or by querying a web service.</p>
</div>
<div id="fig-journey-actors" class="imageblock">
<div class="content">
<img src="_images/journey-actors.png" alt="journey actors">
</div>
<div class="title">Figure 3. The Screenplay Pattern uses an actor-centric model</div>
</div>
<div class="paragraph">
<p>In Serenity, creating an actor is as simple as creating an instance of the Actor class and providing a name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Actor james = Actor.named("James");</code></pre>
</div>
</div>
<div class="paragraph">
<p>We find it useful to give the actors real names, rather than just to use a generic one such as "the user". Different names can be a short-hand for different user roles or personas, and make the scenarios easier to relate to.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_have_abilities"><a class="anchor" href="#_actors_have_abilities"></a>Actors have abilities</h3>
<div class="paragraph">
<p>Actors need to be able to do things to perform their assigned tasks. So we give our actors “abilities”, a bit like the superpowers of a super-hero, but in more mundane. If this is a web test, for example, we need James to be able to browse the web using a browser.</p>
</div>
<div class="paragraph">
<p>Serenity BDD plays well with Selenium WebDriver, and is happy to manage the browser lifecycle for you. All you need to do is to use the @Managed annotation with a WebDriver member variable, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Managed
WebDriver hisBrowser;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then let James use this browser like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">james.can(BrowseTheWeb.with(hisBrowser));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make it clear that this is a precondition for the test (and could very well go in a JUnit <code>@Before</code> method), we can use the syntactic sugar method givenThat():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">givenThat(james).can(BrowseTheWeb.with(hisBrowser));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the actor’s abilities is represented by an Ability class (in this case, <code>BrowseTheWeb</code>) which keeps track of the things the actor needs to perform this ability (for example, the <code>WebDriver</code> instance used to interact with the browser). Keeping the things an actor can do (browse the web, invoke a web service&#8230;&#8203;) separate from the actor makes it easier to extend the actor’s abilities. For example, to add a new custom ability, you just need to implement a new <code>Ability</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_perform_tasks"><a class="anchor" href="#_actors_perform_tasks"></a>Actors perform tasks</h3>
<div class="paragraph">
<p>An actor needs to perform a number of tasks to achieve a business goal. A fairly typical example of a task is “adding a todo item”, which we could write as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">james.attemptsTo(AddATodoItem.called("Buy some milk"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, if the task is a precondition, rather than the main subject of the test, we could write something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">james.wasAbleTo(AddATodoItem.called("Buy some milk"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more readability, we can also wrap the actor in a static method from the <code>GivenWhenThen</code> class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>givenThat()</p>
</li>
<li>
<p>andThat()</p>
</li>
<li>
<p>when()</p>
</li>
<li>
<p>then()</p>
</li>
<li>
<p>and()</p>
</li>
<li>
<p>but()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, we could have written the last line of code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">givenThat(james).wasAbleTo(AddATodoItem.called("Buy some milk"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s break it down to understand what is going on. At the heart of the Screenplay Pattern, an actor performs a sequence of tasks. In Serenity, this mechanism is implemented in the Actor class using a variation of the Command Pattern, where the actor executes each task by invoking a special method called performAs() on the corresponding Task object (see <a href="#fig-journey-command-pattern">The actor invokes the <code>performAs()</code> method on a sequence of tasks</a>).</p>
</div>
<div id="fig-journey-command-pattern" class="imageblock">
<div class="content">
<img src="_images/journey-command-pattern.png" alt="journey command pattern">
</div>
<div class="title">Figure 4. The actor invokes the <code>performAs()</code> method on a sequence of tasks</div>
</div>
<div class="paragraph">
<p>Tasks are just objects that implement the <code>Task</code> interface, and need to implement the <code>performAs(actor)</code> method. In fact, you can think of any Task class as basically a <code>performAs()</code> method alongside a supporting cast of helper methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_can_be_created_using_annotated_fields_or_builders"><a class="anchor" href="#_tasks_can_be_created_using_annotated_fields_or_builders"></a>Tasks can be created using annotated fields or builders</h3>
<div class="paragraph">
<p>To do its reporting magic, Serenity BDD needs to instrument the task and action objects used during the tests. The simplest way to do arrange this is to let Serenity create it for you, just like any other Serenity step library, using the @Steps annotation. In the following code snippet, Serenity will instantiate the openTheApplication field for you, so that James can use it to open the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Steps
OpenTheApplication openTheApplication;
…
james.attemptsTo(openTheApplication);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works well for very simple tasks or actions, for example ones that take no parameters. But for more sophisticated tasks or actions, a builder pattern like the one used with the AddATodoItem earlier on is more convenient. Experienced practitioners generally like to make the builder method and the class name combine to read like an English sentence, so that the intent of the task remains crystal clear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AddATodoItem.called("Buy some milk"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity BDD provides the special Instrumented class that makes it easy to create task or action objects using the builder pattern. For example, the <code>AddATodoItem</code> class has an immutable field called <code>thingToDo</code>, that contains the text to go in the new Todo item.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AddATodoItem implements Task {

    private final String thingToDo;

    protected AddATodoItem(String thingToDo) { this.thingToDo = thingToDo; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can invoke this constructor using the <code>Instrumented.instanceOf().withProperties()</code> methods, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AddATodoItem implements Task {

    private final String thingToDo;

    protected AddATodoItem(String thingToDo) { this.thingToDo = thingToDo; }

    public static AddATodoItem called(String thingToDo) {
        return Instrumented.instanceOf(AddATodoItem.class).withProperties(thingToDo);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_high_level_tasks_rely_on_other_lower_level_tasks_or_actions"><a class="anchor" href="#_high_level_tasks_rely_on_other_lower_level_tasks_or_actions"></a>High level tasks rely on other lower-level tasks or actions</h3>
<div class="paragraph">
<p>To get the job done, a high level business task will usually need to call either lower level business tasks or actions that interact more directly with the application. In practice, this means that the <code>performAs()</code> method of a task typically executes other, lower level tasks or interacts with the application in some other way. For example, adding a todo item requires two UI actions:
  1. Enter the todo text in the text field
  2. Press Return</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual implementation uses pre-defined <code>Action</code> classes (such as <code>Enter</code> and <code>Hit `shown here) that come with Serenity.  `Action</code> classes are very similar to <code>Task</code> classes, except that they focus on interacting directly with the application. Serenity provides a small number of basic Action classes for core UI interactions such as entering field values, clicking on elements, or selecting values from drop-down lists. You can find these in the <code>net.serenitybdd.screenplay.actions</code> package. In practice, these provide a convenient and readable DSL that let you describe common low-level UI interactions needed to perform a task.</p>
</div>
<div class="paragraph">
<p>For example, the UI Action to enter the text defined in the <code>thingToDo</code> field into the input field with an ID value of “new-todo” would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Enter.theValue(thingToDo).into("#new-todo")</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, hard-coding the CSS selector could lead to duplication. A better practice would be to refactor the selector into a simple Page Object class, like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class NewTodoForm extends PageObject {
    public static String NEW_TODO_FIELD = "#new-todo";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, we could use the Serenity Target class to associate a meaningful label with a CSS selector. These labels appear in the test reports and make them more readable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class NewTodoForm extends PageObject {
    public static Target NEW_TODO_FIELD  = Target.the("New Todo Field").locatedBy("#new-todo");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Step</code> annotation on the performAs() method is used to provide information about how the task will appear in the test reports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Step("{0} adds a todo item called #thingToDo")
public &lt;T extends Actor&gt; void performAs(T actor) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any member variables can be referred to in the @Step annotation by name using the hash (‘#’) prefix (like "#thingToDo" in the example). You can also reference the actor itself using the special
"{0} placeholder. The end result is a blow-by-blow account of how each business task was performed (see <a href="#fig-journey-action-report">Test reports show details about both tasks and UI interactions</a>).</p>
</div>
<div id="fig-journey-action-report" class="imageblock">
<div class="content">
<img src="_images/journey-action-report.png" alt="journey action report">
</div>
<div class="title">Figure 5. Test reports show details about both tasks and UI interactions</div>
</div>
</div>
<div class="sect2">
<h3 id="_action_classes_can_access_the_serenity_webdriver_integration"><a class="anchor" href="#_action_classes_can_access_the_serenity_webdriver_integration"></a>Action classes can access the Serenity WebDriver integration</h3>
<div class="paragraph">
<p>You can also write your own <code>Action</code> classes. If the actor has the <code>BrowseTheWeb</code> ability, the Action class can integrate with the Serenity WebDriver support in several ways.</p>
</div>
<div class="paragraph">
<p>One approach is to use the <code>BrowseTheWeb</code> class to access the WebDriver instance associated with an actor. To do this, you use the <code>BrowseTheWeb.as(theActor)</code> method, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public &lt;T extends Actor&gt; void performAs(T theActor) {
    WebElement deleteButton = BrowseTheWeb.as(theActor).findBy(pathTo(target));
    BrowseTheWeb.as(theActor).evaluateJavascript("arguments[0].click()", deleteButton);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_can_be_used_as_building_blocks_by_other_tasks"><a class="anchor" href="#_tasks_can_be_used_as_building_blocks_by_other_tasks"></a>Tasks can be used as building blocks by other tasks</h3>
<div class="paragraph">
<p>It is easy to reuse tasks in other, higher level tasks. For example, the sample project uses a AddTodoItems task to add a number of todo items to the list, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">givenThat(james).wasAbleTo(AddTodoItems.called("Walk the dog", "Put out the garbage"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This task is defined using the AddATodoItem class, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is quite frequent to reuse existing tasks to build up more sophisticated business tasks in this way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_can_ask_questions_about_the_state_of_the_application"><a class="anchor" href="#_actors_can_ask_questions_about_the_state_of_the_application"></a>Actors can ask questions about the state of the application</h3>
<div class="paragraph">
<p>A typical automated acceptance test has three parts:
1. Set up some test data and/or get the application into a known state
2. Perform some action
3. Compare the new application state with what is expected.</p>
</div>
<div class="paragraph">
<p>From a testing perspective, the third step is where the real value lies – this is where we check that the application does what it is supposed to do.</p>
</div>
<div class="paragraph">
<p>In a traditional Serenity test, we would write an assertion using a library like Hamcrest or AssertJ to check an outcome against an expected value. Using the Serenity Screenplay Pattern, we express assertions using a flexible, fluent API quite similar to the one used for Tasks and Actions. In the test shown above, the assertion looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">then(james).should(seeThat(theDisplayedItems, hasItem("Buy some milk")));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The structure of this code is illustrated in <a href="#fig-journey-breakdown">A Serenity Screenplay Pattern assertion</a></p>
</div>
<div id="fig-journey-breakdown" class="imageblock">
<div class="content">
<img src="_images/journey-breakdown.png" alt="journey breakdown">
</div>
<div class="title">Figure 6. A Serenity Screenplay Pattern assertion</div>
</div>
<div class="paragraph">
<p>As you might expect, this code checks a value retrieved from the application (the items displayed on the screen) against an expected value (described by a Hamcrest expression). However, rather than passing an actual value, we pass a Question object. The role of a Question object is to answer a precise question about the state of the application, from the point of view of the actor, and typically using the abilities of the actor to do so.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_use_their_abilities_to_interact_with_the_system"><a class="anchor" href="#_actors_use_their_abilities_to_interact_with_the_system"></a>Actors use their abilities to interact with the system</h3>
<div class="paragraph">
<p>Let’s see this principle in action in another test. The Todo application has a counter in the bottom left hand corner indicating the remaining number of items (see <a href="#fig-journey-remaining-count">The number of remaining items is displayed in the bottom left corner of the list</a>).</p>
</div>
<div id="fig-journey-remaining-count" class="imageblock">
<div class="content">
<img src="_images/journey-remaining-count.png" alt="journey remaining count">
</div>
<div class="title">Figure 7. The number of remaining items is displayed in the bottom left corner of the list</div>
</div>
<div class="paragraph">
<p>The test to describe and verify this behavior could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test needs to check that the number of remaining items is 1. The corresponding assertion is in the last line of the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">then(james).should(seeThat(TheRemainingItemCount.value(), is(1)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Question object here is defined by the <code>TheRemainingItemCount</code> class.  This class has one very precise responsibility: to read the number in the remaining item count text displayed at the bottom of the todo list.</p>
</div>
<div class="paragraph">
<p>The static <code>value()`</code> method is a simple factory method that returns a new instance of the <code>TheRemainingItemCount</code> class.  This is simply to make the code read more fluently.</p>
</div>
<div class="paragraph">
<p><code>Question</code> objects are similar to <code>Task</code> and <code>Action</code> objects. However, instead of the <code>performAs()</code> used for Tasks and Actions, a Question class needs to implement the <code>answeredBy(actor)</code> method, and return a result of a specified type. The <code>TheRemainingItemCount</code> class is configured to return an Integer. Since it will be querying the web interface, we can extend the WebQuestion class to give us access to the powerful Serenity WebDriver API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TheRemainingItemCount extends WebQuestion implements Question&lt;Integer&gt; {
    @Override
    public Integer answeredBy(Actor actor) {...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity provides a number of Interaction classes that let you query the web page using a fluent API. A simple implementation using this approach might be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public Integer answeredBy(Actor actor) {
        return Text.of(TodoCounter.ITEM_COUNT)
                   .onTheScreenOf(actor)
                   .asInteger();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are interaction classes for most WebDriver calls, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attribute</p>
</li>
<li>
<p>CSSValue</p>
</li>
<li>
<p>CurrentlyEnabled</p>
</li>
<li>
<p>CurrentVisibility</p>
</li>
<li>
<p>Enabled</p>
</li>
<li>
<p>JavaScript</p>
</li>
<li>
<p>Presence</p>
</li>
<li>
<p>SelectedOptions</p>
</li>
<li>
<p>SelectedStatus</p>
</li>
<li>
<p>SelectedValue</p>
</li>
<li>
<p>SelectedVisibleTextValue</p>
</li>
<li>
<p>Text</p>
</li>
<li>
<p>TheCoordinates</p>
</li>
<li>
<p>TheLocation</p>
</li>
<li>
<p>TheSize</p>
</li>
<li>
<p>Value</p>
</li>
<li>
<p>Visibility</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A few examples of these methods are shown here:</p>
</div>
<div class="paragraph">
<p>Read the visible text value of a the <code>COUNTRY</code> dropdown list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String country = SelectedVisibleTextValue.of(ProfilePage.COUNTRY).onTheScreenOf(actor).value();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Determine whether the <code>completeItemButton</code> checkbox is checked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Boolean itemChecked = SelectedStatus.of(completeItemButton).onTheScreenOf(actor).as(Boolean.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Determine whether the <code>completeItemButton</code> checkbox is checked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Boolean itemChecked = SelectedStatus.of(completeItemButton).onTheScreenOf(actor).as(Boolean.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return a list of all the elements matching the <code>TODO_ITEMS</code> target:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">return Text.of(ToDoList.TODO_ITEMS)
           .onTheScreenOf(actor)
           .asList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fluent_assertions_with_serenity_screenplay"><a class="anchor" href="#_fluent_assertions_with_serenity_screenplay"></a>Fluent Assertions with Serenity Screenplay</h3>

</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
