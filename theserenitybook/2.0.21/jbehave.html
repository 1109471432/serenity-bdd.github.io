<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled :: The Serenity BDD Book</title>
    <meta name="generator" content="Antora 1.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">The Serenity BDD Book</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core">Source Code on Github</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/serenity-bdd-mentoring/">Serenity Support</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Serenity Online Training</a>

        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div> -->
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="theserenitybook" data-version="2.0.21">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">The Serenity Book</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity BDD Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Serenity BDD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="first-steps.html">First Steps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="step-libraries.html">Working with Step Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing Web Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="web-testing-in-serenity.html">Testing Web Applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="page-objects.html">Working with Page Objects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="angularjs.html">Testing AngularJS applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity with JUnit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-basic.html">JUnit Basic Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit.html">JUnit WebDriver Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-skipping.html">Skipping Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-data-driven.html">Data Driven Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="junit-requirements.html">Modelling JUnit Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity with BDD Frameworks</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="jbehave.html">Working with JBehave</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cucumber.html">Working with Cucumber JVM</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Working with REST APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-rest.html">REST API Testing in Serenity</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity and the Screenplay Pattern</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay.html">Screenplay Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="screenplay-selenium-tasks.html">Web Testing with Screenplay</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-rest.html">REST API Testing with Screenplay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reporting and Living documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="living-documentation.html">Living Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="extended-reports.html">Additional Reports</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Running Serenity tests</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-parallel.html">Running Serenity tests in parallel</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.adoc">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Serenity Book</span>
    <span class="version">2.0.21</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Serenity Book</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.0.21</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">The Serenity Book</a></li>
    <li class="crumb">Serenity with BDD Frameworks</li>
    <li class="crumb"><a href="jbehave.html">Working with JBehave</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/john/Projects/OpenSource/the-serenity-book/modules/ROOT/pages/jbehave.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<div class="paragraph">
<p><a href="http://jbehave.org">JBehave</a> is an open source BDD framework originally written by Dan North, the inventor of BDD.
It is strongly integrated into the JVM world, and widely used by Java development teams which implement BDD practices in their projects.</p>
</div>
<div class="paragraph">
<p>In JBehave, you write automate your acceptance criteria by writing test stories and scenarios using the familiar BDD "given-when-then" notation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Searching by keyword

Meta:
@tag product:search

Narrative:
  In order to find items that I would like to purchase
  As a potential buyer
  I want to be able to search for items containing certain words

Scenario: Should list items related to a specified keyword
Given I want to buy a wool scarf
When I search for local items containing 'wool'
Then I should only see items related to 'wool'

Scenario: Should be able to filter search results by item type
Given I have searched for items containing 'wool'
When I filter results by type 'Handmade'
Then I should only see items containing 'wool' of type 'Handmade'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Scenarios like this go in <code>.story</code> files: a story file is designed to contain all the scenarios (acceptance criteria) of a given user story.
A story file can also have a narrative section at the top, which gives some background and context about the story being tested:</p>
</div>
<div class="paragraph">
<p>You usually implement a JBehave story using classes and methods written in Java, Groovy or Scala.
You implement the story steps using annotated methods to represent the steps in the text scenarios, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SearchByKeywordStepDefinitions {
    @Steps
    BuyerSteps buyer;

    @Given("I want to buy $article")
    public void buyerWantsToBuy(String article) {
        buyer.opens_etsy_home_page();
    }

    @When("I have searched for items containing '$keyword'")
    public void searchByKeyword(String keyword) {
        buyer.searches_for_items_containing(keyword);
        buyer.filters_results_to_local_region();
    }

    @When("I search for local items containing '$keyword'")
    public void localSearchByKeyword(String keyword) {
        buyer.searches_for_items_containing(keyword);
    }

    @Then("I should only see items related to '$keyword'")
    public void resultsForACategoryAndKeywordInARegion(String keyword) {
        buyer.should_see_items_related_to(keyword);
    }
}</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_jbehave_and_serenity"><a class="anchor" href="#_getting_started_with_jbehave_and_serenity"></a>Getting Started with JBehave and Serenity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Serenity and JBehave work well together.
Serenity uses simple conventions to make it easier to get started writing and implementing Serenity stories, and reports on both JBehave and Serenity steps, which can be seamlessly combined in the same class, or placed in separate classes, depending on your preferences.</p>
</div>
<div class="paragraph">
<p>To get started, you will need to add the Serenity JBehave plugin to your project. In Maven, just add the following dependencies to your pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-core&lt;/artifactId&gt;
            &lt;version&gt;${serenity.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.serenity-bdd&lt;/groupId&gt;
            &lt;artifactId&gt;serenity-jbehave&lt;/artifactId&gt;
            &lt;version&gt;${serenity.jbehave.version}&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent in Gradle is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    testCompile 'net.serenity-bdd:core:1.9.36'
    testCompile 'net.serenity-bdd:serenity-jbehave:1.42.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>New versions come out regularly, so be sure to check the Maven Central repository (<a href="http://search.maven.org" class="bare">http://search.maven.org</a>) to know the latest version numbers for each dependency.</p>
</div>
<div class="sect2">
<h3 id="_jbehave_maven_archetype"><a class="anchor" href="#_jbehave_maven_archetype"></a>JBehave Maven Archetype</h3>
<div class="paragraph">
<p>A JBehave archetype is available to help you jumpstart a new project. As usual, you can run <code>mvn archetype:generate -Dfilter=serenity</code> from the command line and then select the <code>net.serenity-bdd:serenity-jbehave-archetype</code> archetype from the proposed list of archetypes.
Or you can use your favorite IDE to generate a new Maven project using an archetype.</p>
</div>
<div class="paragraph">
<p>This archetype creates a project directory structure similar to the one shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+ main
    + java
       + SampleJBehave
           + pages
               - DictionaryPage.java
           + steps
               - EndUserSteps.java
+ test
    + java
       + SampleJBehave
           + jbehave
               - AcceptanceTestSuite.java
               - DefinitionSteps.java
    + resources
        + SampleJBehave
            + stories
                + consult_dictionary
                    - LookupADefinition.story</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_your_project_and_organizing_your_directory_structure"><a class="anchor" href="#_setting_up_your_project_and_organizing_your_directory_structure"></a>Setting up your project and organizing your directory structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JBehave is a highly flexible tool. The downside of this is that, out of the box, JBehave requires quite a bit of bootstrap code to get started. Serenity tries to simplify this process by using a convention-over-configuration approach, which significantly reduces the amount of work needed to get started with your acceptance tests.
In fact, you can get away with as little as an empty JUnit test case and a sensibly-organized directory structure for your JBehave stories.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_junit_test_runner"><a class="anchor" href="#_the_junit_test_runner"></a>The JUnit test runner</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JBehave tests are run via a JUnit runner. This makes it easier to run the tests both from within an IDE or as part of the build process.
All you need to do is to extend the SerenityStories, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package net.serenitybdd.samples.etsy;

import net.serenitybdd.jbehave.SerenityStories;

public class AcceptanceTests extends SerenityStories {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run this test, Serenity will run any JBehave stories that it finds in the default directory location.
By convention, it will look for a <code>stories</code> folder on your classpath, so `src/test/resources/stories' is a good place to put your story files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_organizing_your_requirements"><a class="anchor" href="#_organizing_your_requirements"></a>Organizing your requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Placing all of your JBehave stories in one directory does not scale well; it is generally better to organize them in a directory structure that groups them in some logical way.
In addition, if you structure your requirements well, Serenity will be able to provide much more meaningful reporting on the test results.</p>
</div>
<div class="paragraph">
<p>By default, Serenity supports a simple directory-based convention for organizing your requirements.
The standard structure uses three levels: capabilities, features and stories.
A story is represented by a JBehave .story file so two directory levels underneath the <code>stories</code> directory will do the trick.
An example of this structure is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+ src
  + test
    + resources
      + stories
        + grow_potatoes                     [a capability]
          + grow_organic_potatoes           [a feature]
            - plant_organic_potatoes.story  [a story]
            - dig_up_organic_potatoes.story [another story]
          + grow_sweet_potatoes             [another feature]
          ...</pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer another hierarchy, you can use the <code>serenity.requirement.types</code> system property to override the default convention.
For example. if you prefer to organize your requirements in a hierarchy consisting of epics, theme and stories, you could set the <code>serenity.requirement.types</code> property to <code>epic,theme</code> (the story level is represented by the .story file).</p>
</div>
<div class="paragraph">
<p>When you start a project, you will typically have a good idea of the high level capabilities you intent to implement, and probably some of the main features. If you simply store your .story files in the right directory structure, the Serenity reports will reflect these requirements, even if no tests have yet been specified for them. This is an excellent way to keep track of project progress. At the start of an iteration, the reports will show all of the requirements to be implemented, even those with no tests defined or implemented yet. As the iteration progresses, more and more acceptance criteria will be implemented, until acceptance criteria have been defined and implemented for all of the requirements that need to be developed.</p>
</div>
<div class="paragraph">
<p>An optional but useful feature of the JBehave story format is the narrative section that can be placed at the start of a story to help provide some more context about that story and the scenarios it contains. This narrative will appear in the Serenity reports, to help give product owners, testers and other team members more information about the background and motivations behind each story. For example, if you are working on an online classifieds website, you might want users to be able to search ads using keywords. You could describe this functionality with a textual description like this one from the <code>locating_a_customer.story</code> story file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Narrative:
In order to provide assistance to customers more quickly
As a financial adviser
I want to be able to locate a customer using a variety of different criteria</code></pre>
</div>
</div>
<div class="paragraph">
<p>However to make the reports more useful still, it is a good idea to document not only the stories, but to also do the same for your higher level requirements (Capabilities, Themes). In Serenity, you can do this by placing a text file called <code>narrative.txt</code> in each of the requirements directories you want to document (see below). These files follow the JBehave convention for writing narratives, with an optional title on the first line, followed by a narrative section started by the keyword <code>Narrative:</code>. When a title is provided it will replace the directory name in the reports.
For example, for a search feature for an online classifieds web site, you might have a description along the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Search for online ads

Narrative:
In order to increase sales of advertised articles
As a seller
I want potential buyers to be able to display only the ads for
articles that they might be interested in purchasing.</pre>
</div>
</div>
<div class="paragraph">
<p>When you run these stories (without having implemented any actual tests), you will get a report containing lots of pending tests, but more interestingly, a list of the requirements that need to be implemented, even if there are no tests or stories associated with them yet.
This makes it easier to plan an iteration: you will initially have a set of requirements with only a few tests, but as the iteration moves forward, you will typically see the requirements fill out with pending and passing acceptance criteria as work progresses.</p>
</div>
<div id="jbehave-requirements-report" class="imageblock">
<div class="content">
<img src="_images/jbehave-requirements-report.png" alt="jbehave requirements report">
</div>
<div class="title">Figure 1. You can see the requirements that you need to implement in the requirements report</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_narrative_in_asciidoc_format"><a class="anchor" href="#_narrative_in_asciidoc_format"></a>Narrative in asciidoc format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Narratives can be written in <a href="http://www.methods.co.nz/asciidoc/">Asciidoc</a> for richer formatting. Set the <code>narrative.format</code> property to <code>asciidoc</code> to allow Serenity to parse the narrative in <code>asciidoc</code> format.</p>
</div>
<div class="paragraph">
<p>For example, the following narrative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Item search

Narrative:
In order to find the items I am interested in faster
As a +buyer+
*I want to be able to list all the ads with a particular keyword in the description or title*</pre>
</div>
</div>
<div class="paragraph">
<p>will be rendered on the report as shown below.</p>
</div>
<div id="asciidoc_narrative" class="imageblock">
<div class="content">
<img src="_images/jbehave-asciidoc_narrative.png" alt="jbehave asciidoc narrative" width="475">
</div>
<div class="title">Figure 2. Narrative with asciidoc formatting</div>
</div>
<div class="paragraph">
<p>With Cucumber a Narrative.txt file can also be placed in any requirement directory and will be included in the Serenity reports just like with JBehave.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_story_meta_data"><a class="anchor" href="#_story_meta_data"></a>Story meta-data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the JBehave Meta tag to provide additional information to Serenity about the test. The @driver annotation lets you specify what WebDriver driver to use, eg.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Adding items to the shopping cart

Meta:
@driver phantomjs

Narrative:
  In order to buy multiple items at the same time
  As a buyer
  I want to be able to add multiple items to the shopping cart

Scenario: Should see total price including tax
Given I have searched for items containing 'blue wool'
And I have selected an item
When I add the item to the shopping cart
Then the item should appear in the cart
And the shipping cost should be included in the total price</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>@issue</code> annotation to link scenarios with issues, more information can be found  under <a href="serenity-issues.html" class="page">Linking scenarios/tests with issues</a>.</p>
</div>
<div class="paragraph">
<p>You can also attribute tags to the story as a whole, or to individual scenarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Meta:
@tag capability:a capability

Scenario: A scenario that works
Meta:
@tags domain:a domain, iteration: iteration 1

Given I have an implemented JBehave scenario
And the scenario works
When I run the scenario
Then I should get a successful result</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_the_tests"><a class="anchor" href="#_implementing_the_tests"></a>Implementing the tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want your tests to actually do anything, you will also need classes in which you place your JBehave step implementations. If you place these in any package at or below the package of your main JUnit test, JBehave will find them with no extra configuration.</p>
</div>
<div class="paragraph">
<p>Serenity makes no distinction between the JBehave-style @Given, @When and @Then annotations, and the Serenity-style @Step annotations: both will appear in the test reports. However you need to start with the  @Given, @When and @Then-annotated methods so that JBehave can find the correct methods to call for your stories. A method annotated with @Given, @When or @Then can call Serenity @Step methods, or call page objects directly (though the extra level of abstraction provided by the @Step methods tends to make the tests more reusable and maintainable on larger projects).</p>
</div>
<div class="paragraph">
<p>A typical example is shown below. In this implementation of one of the scenarios we saw above, the high-level steps are defined using methods annotated with the JBehave @Given, @When and @Then annotations. These methods, in turn, use steps that are implemented in the BuyerSteps class, which contains a set of Serenity @Step methods. The advantage of using this two-leveled approach is that it helps maintain a degree of separation between the definition of what is being done in a test, and how it is being implemented. This tends to make the tests easier to understand and easier to maintain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package net.serenitybdd.samples.etsy.features.steps;

import net.serenitybdd.samples.etsy.features.model.ListingItem;
import net.serenitybdd.samples.etsy.features.steps.serenity.BuyerSteps;
import net.serenitybdd.core.Serenity;
import net.serenitybdd.samples.etsy.features.model.SessionVariables;
import net.thucydides.core.annotations.Steps;
import org.jbehave.core.annotations.Given;
import org.jbehave.core.annotations.Then;
import org.jbehave.core.annotations.When;

public class ShoppingCartStepDefinitions {
    @Steps
    BuyerSteps buyer;

    @Given("I have selected an item")
    @When("I select an item")
    public void selectsAnItem() {
        buyer.selects_item_number(1);
    }

    @When("I add the item to the shopping cart")
    public void addCurrentItemToShoppingCart() {
        buyer.selects_any_product_variations();
        buyer.adds_current_item_to_shopping_cart();
    }

    @Then("the item should appear in the cart")
    public void shouldSeeSelectedItemInCart() {
        ListingItem selectedItem = (ListingItem) Serenity.sessionVariableCalled(SessionVariables.SELECTED_LISTING);
        buyer.should_see_item_in_cart(selectedItem);
    }

    @Then("the shipping cost should be included in the total price")
    public void shouldIncludeShippingCost() {
        ListingItem selectedItem = (ListingItem) Serenity.sessionVariableCalled(SessionVariables.SELECTED_LISTING);
        buyer.should_see_total_including_shipping_for(selectedItem);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Serenity steps can be found in the BuyerSteps class. This class in turn uses Page Objects to interact with the actual web application, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package net.serenitybdd.samples.etsy.features.steps.serenity;

import com.google.common.base.Optional;
import net.serenitybdd.core.Serenity;
import net.serenitybdd.samples.etsy.features.model.ListingItem;
import net.serenitybdd.samples.etsy.features.model.OrderCostSummary;
import net.serenitybdd.samples.etsy.features.model.SessionVariables;
import net.serenitybdd.samples.etsy.pages.CartPage;
import net.serenitybdd.samples.etsy.pages.HomePage;
import net.serenitybdd.samples.etsy.pages.ItemDetailsPage;
import net.serenitybdd.samples.etsy.pages.SearchResultsPage;
import net.thucydides.core.annotations.Step;
import org.hamcrest.Matcher;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

// tag::header[]
public class BuyerSteps {
// end::header[]
// tag::searchByKeywordSteps[]

    HomePage homePage;                                          <i class="conum" data-value="1"></i><b>(1)</b>
    SearchResultsPage searchResultsPage;

    @Step                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    public void opens_etsy_home_page() {
        homePage.open();
        homePage.dismissLocationMessage();
        homePage.dismissPrivacyMessage();
    }

    @Step
    public void searches_for_items_containing(String keywords) {
        homePage.searchFor(keywords);
    }

    @Step
    public void should_see_items_related_to(String keywords) {
        List&lt;String&gt; resultTitles = searchResultsPage.getResultTitles();
        resultTitles.stream().forEach(title -&gt; assertThat(title.contains(keywords)));
    }
// end::searchByKeywordSteps[]
// tag::filterByType[]
    @Step
    public void filters_results_by_type(String type) {
        searchResultsPage.filterByType(type);
    }

    public int get_matching_item_count() {
        return searchResultsPage.getItemCount();
    }

    @Step
    public void should_see_item_count(Matcher&lt;Integer&gt; itemCountMatcher) {
        itemCountMatcher.matches(searchResultsPage.getItemCount());
    }
// end::filterByType[]

    @Step
    public void selects_item_number(int number) {
        ListingItem selectedItem = searchResultsPage.selectItem(number);
        Serenity.setSessionVariable(SessionVariables.SELECTED_LISTING).to(selectedItem);
    }

    @Step
    public void should_see_matching_details(String searchTerm) {
        String itemName = detailsPage.getItemName();
        assertThat(itemName.toLowerCase()).contains(searchTerm);
    }

    @Step
    public void should_see_items_of_type(String type) {
        Optional&lt;String&gt; selectedType = searchResultsPage.getSelectedType();
        assertThat(selectedType.isPresent()).describedAs("No item type was selected").isTrue();
        assertThat(selectedType.get()).isEqualTo(type);
    }

    // tag::shoppingCartSteps[]

    ItemDetailsPage detailsPage;
    CartPage cartPage;

    @Step
    public void selects_any_product_variations() {
        detailsPage.getProductVariationIds().stream()
                .forEach(id -&gt; detailsPage.selectVariation(id,2));
    }

    @Step
    public void adds_current_item_to_shopping_cart() {
        detailsPage.selectSize();
        detailsPage.addToCart();
    }

    @Step
    public void should_see_item_in_cart(ListingItem selectedItem) {
        assertThat(cartPage.getOrderCostSummaries()
                        .stream().anyMatch(order -&gt; order.getName().equals(selectedItem.getName()))).isTrue();
    }

    @Step
    public void should_see_total_including_shipping_for(ListingItem selectedItem) {
        OrderCostSummary orderCostSummary
                = cartPage.getOrderCostSummaryFor(selectedItem).get();

        double itemTotal = orderCostSummary.getItemTotal();
        assertThat(itemTotal).isEqualTo(selectedItem.getPrice());
    }

    @Step
    public void filters_results_to_local_region() {
        searchResultsPage.filterByLocalRegion();
    }
    // end::shoppingCartSteps[]

// tag::tail[]
}
//end:tail</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Page Objects are similar to those you would find in any Serenity project, as well as most WebDriver projects. An example is listed below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package net.serenitybdd.samples.etsy.pages;

import net.serenitybdd.core.annotations.findby.By;
import net.serenitybdd.core.pages.PageObject;
import net.serenitybdd.core.pages.WebElementFacade;
import org.openqa.selenium.StaleElementReferenceException;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.FindBys;

import java.util.List;

import static java.util.stream.Collectors.toList;
import static net.serenity_bdd.samples.etsy.pages.Spinners.noSpinnerToBeVisible;

/**
 * Created by john on 18/11/14.
 */
public class ItemDetailsPage extends PageObject {

    @FindBys({@FindBy(id="listing-page-cart"), @FindBy(tagName = "h1")})
    WebElement itemName;

    public String getItemName() {
        return itemName.getText();
    }

    public String getItemDescription() {
        return $("#description-text").getText();
    }

    public void selectSize() {
        List&lt;WebElementFacade&gt; allSizes = findAll(By.id("inventory-variation-select-0"));
        if (!allSizes.isEmpty()) {
            find(By.id("inventory-variation-select-0")).selectByIndex(allSizes.size());
        }
    }

    public void addToCart() {
        waitFor(".buy-button button");
        for(int i = 0 ; i &lt; 3; i++) {
            try {
                $(".buy-button button").click();
                break;
            }
            catch (StaleElementReferenceException staleReferenceException) {}
        }
    }

    public List&lt;String&gt; getProductVariationIds() {
        return findAll(".variation")
                .stream()
                .map(elt -&gt; elt.getAttribute("id"))
                .filter(id -&gt; !id.isEmpty())
                .collect(toList());
    }

    public void selectVariation(String variationId, int optionIndex) {
        find(By.id(variationId)).selectByIndex(optionIndex);
        if (spinnerIsVisible()) {
            waitFor(noSpinnerToBeVisible());
        }
    }

    private boolean spinnerIsVisible() {
        return containsElements(".spinner-small");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When these tests are executed, the JBehave steps combine with the Serenity steps to create a narrative report of the test results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_in_scenario"><a class="anchor" href="#_comments_in_scenario"></a>Comments in scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In case if you use comments in scenario, Serenity will ignore a commented condition, but it will be displayed in the generated report like this:</p>
</div>
<div id="jbehave_comments_report" class="imageblock">
<div class="content">
<img src="_images/jbehave_comments_report.png" alt="jbehave comments report">
</div>
<div class="title">Figure 3. Report with commented conditions in scenario</div>
</div>
<div class="paragraph">
<p>You can comment particular conditions or the whole scenario. Here are some examples for different cases.</p>
</div>
<div class="paragraph">
<p>Commenting one condition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Narrative:
In order to provide some business value
As a user
I want to perform some simple action, but I commented then condition

Scenario: Single scenario with commented then condition
Given I have prepared environment for simple action one
When I perform "simple action one"
!-- Then I expect result for "simple action one" should be "success"</pre>
</div>
</div>
<div class="paragraph">
<p>Report:</p>
</div>
<div id="jbehave_one_condition_commented" class="imageblock">
<div class="content">
<img src="_images/jbehave_one_condition_commented.png" alt="jbehave one condition commented">
</div>
<div class="title">Figure 4. Report with commented Then condition</div>
</div>
<div class="paragraph">
<p>Commenting all conditions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Narrative:
In order to provide some business value
As a user
I want to perform some simple action, but I commented all conditions

Scenario: Single scenario with all commented conditions
!-- Given I have prepared environment for simple action one
!-- When I perform "simple action one"
!-- Then I expect result for "simple action one" should be "success"</pre>
</div>
</div>
<div class="paragraph">
<p>Report:</p>
</div>
<div id="jbehave_all_conditions_commented" class="imageblock">
<div class="content">
<img src="_images/jbehave_all_conditions_commented.png" alt="jbehave all conditions commented">
</div>
<div class="title">Figure 5. Report with commented all conditions</div>
</div>
<div class="paragraph">
<p>Commenting a whole scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Narrative:
In order to provide some business value
As a user
I want to perform some simple action, but I commented scenario

!-- Scenario: Single commented scenario
!-- Given I have prepared environment for simple action one
!-- When I perform "simple action one"
!-- Then I expect result for "simple action one" should be "success"</pre>
</div>
</div>
<div class="paragraph">
<p>Report:</p>
</div>
<div id="jbehave_scenario_commented" class="imageblock">
<div class="content">
<img src="_images/jbehave_scenario_commented.png" alt="jbehave scenario commented">
</div>
<div class="title">Figure 6. Report with commented scenario</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_all_tests_in_a_single_browser_window"><a class="anchor" href="#_running_all_tests_in_a_single_browser_window"></a>Running all tests in a single browser window</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All web tests for one story can be run in a single browser window using either by setting the 'restart.browser.each.scenario' system property or programmatically using runSerenity().inASingleSession() inside the JUnit runner. It is default behaving - to run all scenarios in same story in one browser.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import net.serenitybdd.jbehave.SerenityStories;

public class JBehaveTestCase extends SerenityStories {
    public JBehaveTestCase() {
      runSerenity().inASingleSession();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
